# Компонент редактирования профиля компании

## Описание
Компонент для редактирования данных компании из инфоблока 57. Позволяет руководителям компании и администраторам обновлять информацию о компании.

## Использование

### В коде страницы:
```php
$APPLICATION->IncludeComponent(
    "online-service:company.profile.edit",
    ".default",
    [
        "COMPANY_ID" => $companyId,
        "CACHE_TIME" => 0
    ]
);
```

## Параметры

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| COMPANY_ID | int | Да | ID компании для редактирования |
| CACHE_TIME | int | Нет | Время кеширования (по умолчанию 0) |

## Доступные поля для редактирования

### Обязательные поля:
1. **OS_COMPANY_NAME** - Название компании
2. **OS_COMPANY_INN** - ИНН (10 или 12 цифр)
3. **OS_COMPANY_CITY** - Город
4. **OS_COMPANY_WEB_SITE** - Сайт компании (URL)

### Необязательные поля:
1. **OS_COMPANY_KPP** - КПП (9 цифр)
2. **OS_COMPANY_PHONE** - Телефон
3. **OS_COMPANY_EMAIL** - Email
4. **OS_COMPANY_ADDRESS** - Юридический адрес
5. **OS_COMPANY_SPHERE** - Сфера деятельности

## Права доступа

Доступ к редактированию имеют:
- **Администраторы** - полный доступ
- **Руководители компании** (OS_COMPANY_BOSS) - доступ к своей компании

## Валидация

### ИНН:
- Должен содержать только цифры
- Длина: 10 или 12 символов

### КПП:
- Должен содержать только цифры
- Длина: 9 символов

### Email:
- Должен соответствовать стандартному формату email

### URL сайта:
- Должен быть валидным URL (например: https://example.com)

## AJAX обработчик

Файл: `/local/components/online-service/company.profile.edit/ajax.php`

### Запрос:
```javascript
fetch('/local/components/online-service/company.profile.edit/ajax.php', {
    method: 'POST',
    body: formData
})
```

### Ответ (успех):
```json
{
    "success": true,
    "message": "Данные компании успешно обновлены",
    "company_id": 123
}
```

### Ответ (ошибка):
```json
{
    "success": false,
    "message": "Описание ошибки"
}
```

## Уведомления

Компонент использует модальные окна для отображения статуса операции:

- **Загрузка** - синий индикатор
- **Успех** - зеленый индикатор + автоматический редирект
- **Ошибка** - красный индикатор

## Маски ввода

### Телефон:
Формат: `+7 (999) 999-99-99`

### ИНН:
Только цифры, максимум 12 символов

### КПП:
Только цифры, максимум 9 символов

## Структура файлов

```
company.profile.edit/
├── class.php                    # Основной класс компонента
├── .parameters.php              # Параметры компонента
├── .description.php             # Описание компонента
├── ajax.php                     # AJAX обработчик
├── README.md                    # Документация
└── templates/
    └── .default/
        ├── template.php         # Шаблон компонента
        └── style.css            # Стили компонента
```

## Примеры использования

### Редактирование компании:
```
/company/profile/edit/?id=12345
```

### Кнопка редактирования в профиле:
```php
<?if($canManageCompany):?>
<a href="/company/profile/edit/?id=<?=$arResult['ID']?>" class="company-info__edit-btn">
    Редактировать
</a>
<?endif;?>
```

## Интеграция с системой компаний

Компонент использует класс `OnlineService\Site\Company` для работы с данными:

```php
use OnlineService\Site\Company;

$company = new Company();
$companyData = $company->getCompany($companyId);
```

## Возврат после сохранения

После успешного сохранения происходит автоматический редирект на профиль компании:
```
/company/profile/?id={COMPANY_ID}
```

## Адаптивность

Компонент полностью адаптирован для мобильных устройств:
- До 768px - одна колонка полей
- До 480px - кнопки на всю ширину

